---
title: azure_cosmosdb
type: input
status: experimental
categories: ["Azure"]
---

<!--
     THIS FILE IS AUTOGENERATED!

     To make changes please edit the contents of:
     lib/input/azure_cosmosdb.go
-->

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

:::caution EXPERIMENTAL
This component is experimental and therefore subject to change or removal outside of major version releases.
:::
Executes an SQL query against Azure CosmosDB and creates a batch of messages from each page of items.

Introduced in version 4.10.0.


<Tabs defaultValue="common" values={[
  { label: 'Common', value: 'common', },
  { label: 'Advanced', value: 'advanced', },
]}>

<TabItem value="common">

```yml
# Common config fields, showing default values
input:
  label: ""
  azure_cosmosdb:
    endpoint: ""
    account_key: ""
    database_id: ""
    container_id: ""
    partition_key: ""
    partition_key_type: string
    query: ""
    args_mapping: ""
```

</TabItem>
<TabItem value="advanced">

```yml
# All config fields, showing default values
input:
  label: ""
  azure_cosmosdb:
    endpoint: ""
    account_key: ""
    database_id: ""
    container_id: ""
    partition_key: ""
    partition_key_type: string
    query: ""
    args_mapping: ""
    batch_count: -1
```

</TabItem>
</Tabs>

## Metadata

This input adds the following metadata fields to each message:

```
- activity_id
- request_charge
```

### CosmosDB Emulator

If you wish to run the CosmosDB emulator that is referenced in the documentation [here](https://learn.microsoft.com/en-us/azure/cosmos-db/linux-emulator),
the following Docker command should do the trick:

```shell
> docker run --rm -it -p 8081:8081 --name=cosmosdb -e AZURE_COSMOS_EMULATOR_PARTITION_COUNT=2 -e AZURE_COSMOS_EMULATOR_ENABLE_DATA_PERSISTENCE=false mcr.microsoft.com/cosmosdb/linux/azure-cosmos-emulator
```

Note: `AZURE_COSMOS_EMULATOR_PARTITION_COUNT` controls how many database, container and partition combinations are
supported. The bigger the value, the longer it takes for the container to start up.

Additionally, instead of installing the container self-signed certificate which is exposed via
`https://localhost:8081/_explorer/emulator.pem`, you can run [mitmproxy](https://mitmproxy.org/) like so:

```shell
> mitmproxy -k --mode "reverse:https://localhost:8081"
```

Then you can access the CosmosDB UI via `http://localhost:8080/_explorer/index.html` and use
`http://localhost:8080` as the CosmosDB endpoint.


## Fields

### `endpoint`

CosmosDB endpoint.


Type: `string`  

```yml
# Examples

endpoint: https://localhost:8081
```

### `account_key`

Account key.


Type: `string`  

```yml
# Examples

account_key: C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==
```

### `database_id`

Database ID.


Type: `string`  

```yml
# Examples

database_id: TestDB
```

### `container_id`

Container ID.


Type: `string`  

```yml
# Examples

container_id: TestContainer
```

### `partition_key`

Partition key.
This field supports [interpolation functions](/docs/configuration/interpolation#bloblang-queries).


Type: `string`  

```yml
# Examples

partition_key: ${! json("foobar") }
```

### `partition_key_type`

Partition key type.


Type: `string`  
Default: `"string"`  

| Option | Summary |
|---|---|
| `bool` | partition_key contains a boolean. |
| `number` | partition_key contains a number. |
| `string` | partition_key contains a string. |


### `query`

The query to execute


Type: `string`  

```yml
# Examples

query: SELECT c.foo FROM TestContainer AS c WHERE c.bar = "baz" AND c.timestamp < @timestamp
```

### `args_mapping`

A [Bloblang mapping](/docs/guides/bloblang/about) that, for each message, creates a list of arguments to use with the query.


Type: `string`  

```yml
# Examples

args_mapping: |2
   args_mapping: |
    root = [
      { "Name": "@timestamp", "Value": timestamp_unix() - 3600 },
  ]
```

### `batch_count`

The maximum number of messages that should be accumulated into each batch. '-1' represents dynamic page size.


Type: `int`  
Default: `-1`  


